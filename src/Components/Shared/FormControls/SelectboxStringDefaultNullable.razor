@* Facilitates a String selectbox with a default value and stores null when the default value is selected *@

@{
    var incomingClass = string.Empty;
    if (AdditionalAttributes != null && AdditionalAttributes.TryGetValue("class", out var c) && c is string cs)
    {
        incomingClass = cs?.Trim() ?? string.Empty;
    }
    var selectClass = string.IsNullOrEmpty(incomingClass) ? "form-control" : $"form-control {incomingClass}";

    Dictionary<string, object>? otherAttrs = null;
    if (AdditionalAttributes != null)
    {
        otherAttrs = new Dictionary<string, object>(AdditionalAttributes);
        otherAttrs.Remove("class");
    }
}

<select class="@selectClass" @attributes="otherAttrs" @onchange="OnChange" value="@(Value ?? DefaultValue)">
    @ChildContent
</select>

@code {
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? AdditionalAttributes { get; set; }

    [Parameter] public string? Value { get; set; }
    [Parameter] public EventCallback<string?> ValueChanged { get; set; }
    [Parameter] public string DefaultValue { get; set; } = string.Empty;
    [Parameter] public RenderFragment? ChildContent { get; set; }

    private async Task OnChange(ChangeEventArgs e)
    {
        var s = e?.Value?.ToString() ?? string.Empty;
        if (string.IsNullOrEmpty(s) || s == DefaultValue)
        {
            await ValueChanged.InvokeAsync(null);
            return;
        }
        await ValueChanged.InvokeAsync(s);
    }
}
