@* Handles validation as you type in an InputText*@
@inherits InputText

<input @attributes="AdditionalAttributes"
       class="@CssClass"
       value="@(CurrentValueAsString ?? string.Empty)"
       @oninput="HandleInput" />
       @if (AddFocusGrabber){
              @* Hides keyboard on mobile devices when you click Next on the virtual keyboard.
                 Position the select offscreen so it does not participate in the input-group layout
                 (avoids breaking rounded corners) but remains focusable. *@
              <select class="ww-focus-grabber" tabindex="0"></select>
       }

@code {
       [Parameter]
       public EventCallback<string> OnInput { get; set; }
       [Parameter] public bool AddFocusGrabber { get; set; } = false;
       [Parameter] public string? ReplaceSpaceWith { get; set; }

       private async Task HandleInput(ChangeEventArgs e)
       {
              var raw = e?.Value?.ToString() ?? string.Empty;
              // Replace spaces with the configured replacement as the user types
              var normalized = string.IsNullOrEmpty(ReplaceSpaceWith) ? raw : raw.Replace(" ", ReplaceSpaceWith);
              CurrentValueAsString = normalized;
              // Forward the current string value to the parent so @oninput handlers receive the bound value type expected by Razor.
              if (OnInput.HasDelegate)
              {
                     await OnInput.InvokeAsync(CurrentValueAsString);
              }
       }
}