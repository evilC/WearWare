@page "/import"
@using WearWare.Common.Media
@using WearWare.Components.Forms.EditPlayableItemForm
@rendermode InteractiveServer

<h3>Import</h3>

@if (showEditDialog && _editingItem != null && selectedFileName != null)
{
    <EditPlayableItemForm @ref="editFormRef" EditingItem="_editingItem" EditingIndex="0" ItemType="PlayableItemType.Import" FormMode="PlayableItemFormMode.Add" ImageUrl="@($"/incoming-media/{selectedFileName}")" OnSave="OnSaveImportItem" OnCancel="OnEditFormCancel" />
}
else if (importFiles == null)
{
    <p>Loading images...</p>
}
else if (!importFiles.Any())
{
    <p>No images found in the incoming folder.</p>
}
else
{
    <div class="mb-3">
        <button type="button" class="btn btn-primary" @onclick="TriggerFileInput">Upload new file</button>
        <InputFile id="@inputId" style="display:none;" OnChange="HandleFileSelected" />
    </div>
    <ul class="import-list" style="list-style:none; padding:0; margin:0;">
        @foreach (var file in importFiles)
        {
            <li style="margin-bottom:2em; display:flex; align-items:center; gap:0.5em; cursor:pointer;"
                @onclick="() => ShowForm(file)">
                <div style="display:flex; flex-direction:column; gap:0.25em;">
                    <button type="button" class="btn btn-sm btn-outline-danger" @onclick="() => ConfirmDelete(file)" @onclick:stopPropagation="true">Delete</button>
                </div>
                <img src="/incoming-media/@file" alt="@file" style="max-width: 64px; max-height: 64px; display: block;" />
                <div>
                    <strong style="font-size:1em; color:#222;">@file</strong><br />
                </div>
            </li>
        }
    </ul>
}